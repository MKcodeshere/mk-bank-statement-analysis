<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Analyzer</title>
    
    <!-- Load React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Load Chart.js for reliable charting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Simple icons -->
    <script>
        window.Icons = {
            Upload: () => React.createElement('div', { 
                className: "w-6 h-6 border-2 border-gray-400 rounded flex items-center justify-center text-gray-400 text-xs" 
            }, "üìÅ"),
            TrendingUp: () => React.createElement('div', { 
                className: "w-6 h-6 text-green-500 text-xl" 
            }, "üìà"),
            TrendingDown: () => React.createElement('div', { 
                className: "w-6 h-6 text-red-500 text-xl" 
            }, "üìâ"),
            DollarSign: () => React.createElement('div', { 
                className: "w-6 h-6 text-blue-500 text-xl" 
            }, "üí∞"),
            CreditCard: () => React.createElement('div', { 
                className: "w-6 h-6 text-purple-500 text-xl" 
            }, "üí≥"),
            Search: () => React.createElement('div', { 
                className: "w-4 h-4 text-gray-400 text-sm" 
            }, "üîç"),
            ChevronDown: () => React.createElement('div', { 
                className: "w-4 h-4 text-gray-400" 
            }, "‚ñº"),
            ChevronRight: () => React.createElement('div', { 
                className: "w-4 h-4 text-gray-400" 
            }, "‚ñ∂"),
            Eye: () => React.createElement('div', { 
                className: "w-4 h-4 text-gray-400" 
            }, "üëÅ"),
            EyeOff: () => React.createElement('div', { 
                className: "w-4 h-4 text-gray-400" 
            }, "üö´"),
            BarChart3: () => React.createElement('div', { 
                className: "w-6 h-6 text-gray-500 text-xl" 
            }, "üìä"),
            PieChart: () => React.createElement('div', { 
                className: "w-6 h-6 text-gray-500 text-xl" 
            }, "ü•ß"),
            Store: () => React.createElement('div', { 
                className: "w-6 h-6 text-gray-500 text-xl" 
            }, "üè™")
        };
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        // Use the simple icons
        const Upload = Icons.Upload;
        const TrendingUp = Icons.TrendingUp;
        const TrendingDown = Icons.TrendingDown;
        const DollarSign = Icons.DollarSign;
        const CreditCard = Icons.CreditCard;
        const Search = Icons.Search;
        const ChevronDown = Icons.ChevronDown;
        const ChevronRight = Icons.ChevronRight;
        const Eye = Icons.Eye;
        const EyeOff = Icons.EyeOff;
        const BarChart3 = Icons.BarChart3;
        const PieChart = Icons.PieChart;
        const Store = Icons.Store;

        // Chart components using Chart.js
        const LineChart = ({ data, title }) => {
          const canvasRef = useRef(null);
          const chartRef = useRef(null);

          useEffect(() => {
            if (canvasRef.current && data.length > 0) {
              // Destroy existing chart
              if (chartRef.current) {
                chartRef.current.destroy();
              }

              const ctx = canvasRef.current.getContext('2d');
              chartRef.current = new Chart(ctx, {
                type: 'line',
                data: {
                  labels: data.map(d => d.period),
                  datasets: [
                    {
                      label: 'Spending',
                      data: data.map(d => d.spending),
                      borderColor: '#ef4444',
                      backgroundColor: 'rgba(239, 68, 68, 0.1)',
                      tension: 0.4,
                      fill: false
                    },
                    {
                      label: 'Income',
                      data: data.map(d => d.income),
                      borderColor: '#10b981',
                      backgroundColor: 'rgba(16, 185, 129, 0.1)',
                      tension: 0.4,
                      fill: false
                    }
                  ]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                    y: {
                      beginAtZero: true,
                      ticks: {
                        callback: function(value) {
                          return '‚Çπ' + (value / 1000).toFixed(0) + 'k';
                        }
                      }
                    }
                  },
                  plugins: {
                    tooltip: {
                      callbacks: {
                        label: function(context) {
                          return context.dataset.label + ': ‚Çπ' + context.parsed.y.toLocaleString('en-IN');
                        }
                      }
                    }
                  }
                }
              });
            }

            return () => {
              if (chartRef.current) {
                chartRef.current.destroy();
              }
            };
          }, [data]);

          return (
            <div className="relative h-80">
              <canvas ref={canvasRef}></canvas>
            </div>
          );
        };

        const DoughnutChart = ({ data }) => {
          const canvasRef = useRef(null);
          const chartRef = useRef(null);

          useEffect(() => {
            if (canvasRef.current && data.length > 0) {
              if (chartRef.current) {
                chartRef.current.destroy();
              }

              const ctx = canvasRef.current.getContext('2d');
              const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#06b6d4', '#f97316', '#84cc16', '#ec4899'];
              
              chartRef.current = new Chart(ctx, {
                type: 'doughnut',
                data: {
                  labels: data.map(d => d.category),
                  datasets: [{
                    data: data.map(d => d.amount),
                    backgroundColor: colors.slice(0, data.length),
                    borderWidth: 2,
                    borderColor: '#ffffff'
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      position: 'bottom',
                      labels: {
                        padding: 20,
                        usePointStyle: true
                      }
                    },
                    tooltip: {
                      callbacks: {
                        label: function(context) {
                          const percentage = ((context.parsed / data.reduce((sum, d) => sum + d.amount, 0)) * 100).toFixed(1);
                          return context.label + ': ‚Çπ' + context.parsed.toLocaleString('en-IN') + ` (${percentage}%)`;
                        }
                      }
                    }
                  }
                }
              });
            }

            return () => {
              if (chartRef.current) {
                chartRef.current.destroy();
              }
            };
          }, [data]);

          return (
            <div className="relative h-80">
              <canvas ref={canvasRef}></canvas>
            </div>
          );
        };

        const FinanceAnalyzer = () => {
          const [transactions, setTransactions] = useState([]);
          const [dateRange, setDateRange] = useState({ start: '', end: '' });
          const [selectedPeriod, setSelectedPeriod] = useState('monthly');
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedCategory, setSelectedCategory] = useState('all');
          const [expandedCategories, setExpandedCategories] = useState({});
          const [showIncomeBreakdown, setShowIncomeBreakdown] = useState(false);

          // Categorization function
          const categorizeTransaction = (narration) => {
            if (!narration) return 'Others';
            const narrationLower = narration.toLowerCase();
            
            if (narrationLower.includes('zerodha')) return 'Stock Investment';
            if (narrationLower.includes('leelavathi')) return 'Wife Spending';
            if (narrationLower.includes('kotak securities')) return 'Kotak Money';
            if (narrationLower.includes('autorelli')) return 'Car Spending';
            if (narrationLower.includes('babyhug')) return 'Baby Spending';
            if (narrationLower.includes('zomato')) return 'Zomato Food Orders';
            if (narrationLower.includes('sudha coffee')) return 'Coffee Spending';
            if (narrationLower.includes('fuel')) return 'Petrol';
            if (narrationLower.includes('jewellers') || narrationLower.includes('thangamaliga')) return 'Jewellers';
            if (narrationLower.includes('indian clearing corp') || narrationLower.includes('pgim') || narrationLower.includes('india corp clearing')) return 'Mutual Fund';
            if (narrationLower.includes('openai') || narrationLower.includes('claude')) return 'AI Monthly Purchase';
            if (narrationLower.includes('apollo')) return 'Medical Expense';
            if (narrationLower.includes('bsnl') || narrationLower.includes('bharat sanchar nigam')) return 'Broadband Expense';
            if (narrationLower.includes('airtel')) return 'DTH & Mobile Expense';
            if (narrationLower.includes('fasttag')) return 'Toll Expense';
            if (narrationLower.includes('appleservices')) return 'Apple Expenses';
            if (narrationLower.includes('hlic')) return 'Term Plan';
            if (narrationLower.includes('amazon')) return 'Amazon';
            if (narrationLower.includes('alice')) return 'Alice Super Market';
            if (narrationLower.includes('trends')) return 'Reliance Trends';
            
            // ATM withdrawals
            if (narrationLower.includes('nwd') || narrationLower.includes('atw') || narrationLower.includes('eaw') || narrationLower.includes('nfs') || narrationLower.includes('awb')) return 'ATM Withdrawal';
            if (narrationLower.includes('ats') && !narrationLower.includes('bharat') && !narrationLower.includes('sanchar')) return 'ATM Withdrawal';
            
            if (narrationLower.includes('upi')) return 'UPI Payments';
            return 'Others';
          };

          const getMonthName = (monthIndex) => {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return months[monthIndex];
          };

          // CSV Parser
          const parseCSV = (csvText) => {
            console.log('Starting CSV parse...');
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) return [];
            
            const parsed = [];
            
            for (let i = 1; i < lines.length; i++) {
              const line = lines[i].trim();
              if (!line) continue;
              
              let values = line.split(',').map(v => v.trim());
              
              // Handle comma in narration issue
              if (values.length === 8 && values[2] === '') {
                values = [values[0], values[1], values[3], values[4], values[5], values[6], values[7]];
              }
              
              if (values.length < 7) continue;
              
              const date = values[0].replace(/^"(.*)"$/, '$1').trim();
              const narration = values[1].replace(/^"(.*)"$/, '$1').trim();
              const debitAmountStr = values[3].replace(/^"(.*)"$/, '$1').trim();
              const creditAmountStr = values[4].replace(/^"(.*)"$/, '$1').trim();
              const closingBalanceStr = values[6].replace(/^"(.*)"$/, '$1').trim();
              
              const cleanAmount = (amountStr) => {
                if (!amountStr) return 0;
                const cleaned = amountStr.replace(/\s/g, '').replace(/[^\d.-]/g, '');
                const parsed = parseFloat(cleaned);
                return isNaN(parsed) ? 0 : Math.abs(parsed);
              };
              
              const debitAmount = cleanAmount(debitAmountStr);
              const creditAmount = cleanAmount(creditAmountStr);
              const closingBalance = cleanAmount(closingBalanceStr);
              
              if (date && (debitAmount > 0 || creditAmount > 0)) {
                parsed.push({
                  date,
                  narration,
                  debitAmount,
                  creditAmount,
                  netAmount: creditAmount - debitAmount,
                  closingBalance,
                  category: categorizeTransaction(narration),
                  type: debitAmount > 0 ? 'debit' : 'credit'
                });
              }
            }
            
            console.log(`Parsed ${parsed.length} transactions`);
            return parsed;
          };

          // File upload handler
          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                const csvText = e.target.result;
                const parsedTransactions = parseCSV(csvText);
                setTransactions(parsedTransactions);
                
                if (parsedTransactions.length > 0) {
                  const dates = parsedTransactions.map(t => {
                    const [day, month, year] = t.date.split('/');
                    const fullYear = year.length === 2 ? '20' + year : year;
                    return new Date(fullYear, month - 1, day);
                  });
                  
                  const minDate = new Date(Math.min(...dates));
                  const maxDate = new Date(Math.max(...dates));
                  
                  setDateRange({ 
                    start: minDate.toISOString().split('T')[0], 
                    end: maxDate.toISOString().split('T')[0] 
                  });
                }
              };
              reader.readAsText(file);
            }
          };

          // Filter transactions
          const filteredTransactions = useMemo(() => {
            return transactions.filter(transaction => {
              const [day, month, year] = transaction.date.split('/');
              const fullYear = year.length === 2 ? '20' + year : year;
              const transactionDate = new Date(fullYear, month - 1, day);
              
              const startDate = dateRange.start ? new Date(dateRange.start) : new Date('1900-01-01');
              const endDate = dateRange.end ? new Date(dateRange.end) : new Date('2100-12-31');
              const dateInRange = transactionDate >= startDate && transactionDate <= endDate;
              
              const matchesSearch = searchTerm === '' || transaction.narration.toLowerCase().includes(searchTerm.toLowerCase());
              const matchesCategory = selectedCategory === 'all' || transaction.category === selectedCategory;
              
              return dateInRange && matchesSearch && matchesCategory;
            });
          }, [transactions, dateRange, searchTerm, selectedCategory]);

          // Summary calculations
          const summary = useMemo(() => {
            const totalDebit = filteredTransactions.reduce((sum, t) => sum + t.debitAmount, 0);
            const totalCredit = filteredTransactions.reduce((sum, t) => sum + t.creditAmount, 0);
            const netFlow = totalCredit - totalDebit;
            
            return {
              totalSpending: totalDebit,
              totalIncome: totalCredit,
              netFlow,
              transactionCount: filteredTransactions.length
            };
          }, [filteredTransactions]);

          // Group data by period for charts
          const groupedData = useMemo(() => {
            const groups = {};
            
            filteredTransactions.forEach(transaction => {
              const [day, month, year] = transaction.date.split('/');
              const fullYear = year.length === 2 ? '20' + year : year;
              const date = new Date(fullYear, month - 1, day);
              
              let key, displayLabel;
              
              if (selectedPeriod === 'daily') {
                key = `${fullYear}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                displayLabel = `${day}/${month}`;
              } else if (selectedPeriod === 'weekly') {
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay());
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                key = weekStart.toISOString().split('T')[0];
                displayLabel = `${weekStart.getDate()}/${weekStart.getMonth() + 1} - ${weekEnd.getDate()}/${weekEnd.getMonth() + 1}`;
              } else {
                key = `${fullYear}-${month.padStart(2, '0')}`;
                displayLabel = `${getMonthName(parseInt(month) - 1)} ${fullYear}`;
              }
              
              if (!groups[key]) {
                groups[key] = { 
                  period: key, 
                  displayLabel,
                  spending: 0, 
                  income: 0, 
                  date: date
                };
              }
              
              groups[key].spending += transaction.debitAmount;
              groups[key].income += transaction.creditAmount;
            });
            
            return Object.values(groups)
              .sort((a, b) => a.date - b.date)
              .map(group => ({
                period: group.displayLabel,
                spending: group.spending,
                income: group.income
              }));
          }, [filteredTransactions, selectedPeriod]);

          // Category data
          const categoryData = useMemo(() => {
            const categories = {};
            
            filteredTransactions.forEach(transaction => {
              if (transaction.debitAmount > 0) {
                if (!categories[transaction.category]) {
                  categories[transaction.category] = {
                    amount: 0,
                    transactions: []
                  };
                }
                categories[transaction.category].amount += transaction.debitAmount;
                categories[transaction.category].transactions.push(transaction);
              }
            });
            
            return Object.entries(categories).map(([category, data]) => ({
              category,
              amount: data.amount,
              transactions: data.transactions,
              percentage: (data.amount / summary.totalSpending * 100).toFixed(1)
            })).sort((a, b) => b.amount - a.amount);
          }, [filteredTransactions, summary.totalSpending]);

          // Top merchants
          const topMerchants = useMemo(() => {
            const merchants = {};
            
            filteredTransactions.forEach(transaction => {
              if (transaction.debitAmount > 0) {
                // Extract merchant name from narration
                let merchant = transaction.narration;
                
                // Try to extract meaningful merchant name
                if (merchant.includes('UPI-')) {
                  const upiPart = merchant.split('UPI-')[1];
                  merchant = upiPart.split('-')[0] || merchant;
                } else if (merchant.includes('POS')) {
                  const posParts = merchant.split(' ');
                  merchant = posParts.slice(2).join(' ').split(',')[0] || merchant;
                }
                
                merchant = merchant.trim().substring(0, 30);
                
                if (!merchants[merchant]) {
                  merchants[merchant] = { name: merchant, amount: 0, count: 0 };
                }
                merchants[merchant].amount += transaction.debitAmount;
                merchants[merchant].count += 1;
              }
            });
            
            return Object.values(merchants).sort((a, b) => b.amount - a.amount).slice(0, 5);
          }, [filteredTransactions]);

          // Income data
          const incomeData = useMemo(() => {
            return filteredTransactions
              .filter(transaction => transaction.creditAmount > 0)
              .sort((a, b) => b.creditAmount - a.creditAmount);
          }, [filteredTransactions]);

          const toggleCategoryExpansion = (category) => {
            setExpandedCategories(prev => ({
              ...prev,
              [category]: !prev[category]
            }));
          };

          const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(amount);
          };

          const categories = ['all', ...new Set(transactions.map(t => t.category))];

          return (
            <div className="min-h-screen bg-gray-50 p-4">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                  <h1 className="text-3xl font-bold text-gray-900 mb-2">Personal Finance Analyzer</h1>
                  <p className="text-gray-600">Upload your bank statement to analyze your spending patterns and gain financial insights</p>
                </div>

                {/* File Upload */}
                {transactions.length === 0 && (
                  <div className="bg-white rounded-lg shadow-sm p-8 mb-6">
                    <div className="text-center">
                      <div className="mx-auto mb-4">
                        <Upload />
                      </div>
                      <h3 className="text-lg font-semibold text-gray-900 mb-2">Upload Your Bank Statement</h3>
                      <p className="text-gray-600 mb-6">Select your .txt bank statement file to get started</p>
                      <input
                        type="file"
                        accept=".txt,.csv"
                        onChange={handleFileUpload}
                        className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                      />
                    </div>
                  </div>
                )}

                {/* Show content if transactions exist */}
                {transactions.length > 0 && (
                  <>
                    {/* Controls */}
                    <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                          <input
                            type="date"
                            value={dateRange.start}
                            onChange={(e) => setDateRange({...dateRange, start: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                          <input
                            type="date"
                            value={dateRange.end}
                            onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Period</label>
                          <select
                            value={selectedPeriod}
                            onChange={(e) => setSelectedPeriod(e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Category</label>
                          <select
                            value={selectedCategory}
                            onChange={(e) => setSelectedCategory(e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            {categories.map(cat => (
                              <option key={cat} value={cat}>{cat === 'all' ? 'All Categories' : cat}</option>
                            ))}
                          </select>
                        </div>
                      </div>
                      <div className="mt-4">
                        <div className="relative">
                          <div className="absolute left-3 top-3">
                            <Search />
                          </div>
                          <input
                            type="text"
                            placeholder="Search transactions..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                      </div>
                    </div>

                    {/* Summary Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                      <div className="bg-white rounded-lg shadow-sm p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600">Total Spending</p>
                            <p className="text-2xl font-bold text-red-600">{formatCurrency(summary.totalSpending)}</p>
                          </div>
                          <TrendingDown />
                        </div>
                      </div>
                      <div className="bg-white rounded-lg shadow-sm p-6">
                        <div className="flex items-center justify-between">
                          <div className="flex-1">
                            <div className="flex items-center justify-between">
                              <p className="text-sm text-gray-600">Total Income</p>
                              <button
                                onClick={() => setShowIncomeBreakdown(!showIncomeBreakdown)}
                                className="p-1 text-gray-400 hover:text-gray-600 transition-colors"
                                title={showIncomeBreakdown ? "Hide breakdown" : "Show breakdown"}
                              >
                                {showIncomeBreakdown ? <EyeOff /> : <Eye />}
                              </button>
                            </div>
                            <p className="text-2xl font-bold text-green-600">{formatCurrency(summary.totalIncome)}</p>
                          </div>
                          <TrendingUp />
                        </div>
                        {showIncomeBreakdown && incomeData.length > 0 && (
                          <div className="mt-4 pt-4 border-t border-gray-100">
                            <p className="text-xs text-gray-500 mb-2">Income Breakdown ({incomeData.length} transactions)</p>
                            <div className="space-y-2 max-h-32 overflow-y-auto">
                              {incomeData.map((transaction, index) => (
                                <div key={index} className="flex flex-col text-xs bg-gray-50 rounded p-2">
                                  <div className="flex justify-between items-start">
                                    <span className="text-gray-700 font-medium">
                                      {transaction.date}
                                    </span>
                                    <span className="font-medium text-green-600 ml-2">
                                      +{formatCurrency(transaction.creditAmount)}
                                    </span>
                                  </div>
                                  <span className="text-gray-600 mt-1 text-left break-words">
                                    {transaction.narration}
                                  </span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                      <div className="bg-white rounded-lg shadow-sm p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600">Net Flow</p>
                            <p className={`text-2xl font-bold ${summary.netFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                              {formatCurrency(summary.netFlow)}
                            </p>
                          </div>
                          <DollarSign />
                        </div>
                      </div>
                      <div className="bg-white rounded-lg shadow-sm p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600">Transactions</p>
                            <p className="text-2xl font-bold text-blue-600">{summary.transactionCount}</p>
                          </div>
                          <CreditCard />
                        </div>
                      </div>
                    </div>

                    {/* Charts */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                      {/* Spending Trend Chart */}
                      <div className="bg-white rounded-lg shadow-sm p-6">
                        <div className="flex items-center mb-4">
                          <BarChart3 />
                          <h3 className="text-lg font-semibold text-gray-900 ml-2">
                            Spending Trend ({selectedPeriod.charAt(0).toUpperCase() + selectedPeriod.slice(1)})
                          </h3>
                        </div>
                        {groupedData.length > 0 ? (
                          <LineChart data={groupedData} title="Spending Trend" />
                        ) : (
                          <div className="flex items-center justify-center h-80 text-gray-500">
                            <div className="text-center">
                              <BarChart3 />
                              <p className="mt-2">No data available for the selected period</p>
                              <p className="text-sm">Try adjusting your date range or filters</p>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Category Pie Chart */}
                      <div className="bg-white rounded-lg shadow-sm p-6">
                        <div className="flex items-center mb-4">
                          <PieChart />
                          <h3 className="text-lg font-semibold text-gray-900 ml-2">Spending by Category</h3>
                        </div>
                        {categoryData.length > 0 ? (
                          <DoughnutChart data={categoryData} />
                        ) : (
                          <div className="flex items-center justify-center h-80 text-gray-500">
                            <div className="text-center">
                              <PieChart />
                              <p className="mt-2">No spending data available</p>
                              <p className="text-sm">Upload transactions to see category breakdown</p>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Top Merchants */}
                    <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                      <div className="flex items-center mb-4">
                        <Store />
                        <h3 className="text-lg font-semibold text-gray-900 ml-2">Top Merchants</h3>
                      </div>
                      {topMerchants.length > 0 ? (
                        <div className="space-y-4">
                          {topMerchants.map((merchant, index) => (
                            <div key={merchant.name} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                              <div className="flex items-center">
                                <div className="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">
                                  {index + 1}
                                </div>
                                <div>
                                  <p className="font-medium text-gray-900">{merchant.name}</p>
                                  <p className="text-sm text-gray-600">{merchant.count} transactions</p>
                                </div>
                              </div>
                              <div className="text-right">
                                <p className="font-semibold text-gray-900">{formatCurrency(merchant.amount)}</p>
                                <p className="text-sm text-gray-600">
                                  Avg: {formatCurrency(merchant.amount / merchant.count)}
                                </p>
                              </div>
                            </div>
                          ))}
                        </div>
                      ) : (
                        <div className="text-center py-8 text-gray-500">
                          <Store />
                          <p className="mt-2">No merchant data available</p>
                          <p className="text-sm">Upload transactions to see top merchants</p>
                        </div>
                      )}
                    </div>

                    {/* Category Analysis */}
                    <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                      <h3 className="text-lg font-semibold text-gray-900 mb-4">Category Analysis</h3>
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead>
                            <tr className="border-b border-gray-200">
                              <th className="text-left py-3 px-4 font-semibold text-gray-900">Category</th>
                              <th className="text-right py-3 px-4 font-semibold text-gray-900">Amount</th>
                              <th className="text-right py-3 px-4 font-semibold text-gray-900">Percentage</th>
                              <th className="text-center py-3 px-4 font-semibold text-gray-900">Transactions</th>
                              <th className="text-center py-3 px-4 font-semibold text-gray-900">Details</th>
                            </tr>
                          </thead>
                          <tbody>
                            {categoryData.map((category, index) => (
                              <React.Fragment key={category.category}>
                                <tr className="border-b border-gray-100 hover:bg-gray-50">
                                  <td className="py-3 px-4 text-gray-900 font-medium">{category.category}</td>
                                  <td className="py-3 px-4 text-right text-gray-900">{formatCurrency(category.amount)}</td>
                                  <td className="py-3 px-4 text-right text-gray-600">{category.percentage}%</td>
                                  <td className="py-3 px-4 text-center text-gray-600">{category.transactions.length}</td>
                                  <td className="py-3 px-4 text-center">
                                    <button
                                      onClick={() => toggleCategoryExpansion(category.category)}
                                      className="p-1 text-gray-400 hover:text-gray-600 transition-colors"
                                      title={expandedCategories[category.category] ? "Hide transactions" : "Show transactions"}
                                    >
                                      {expandedCategories[category.category] ? <ChevronDown /> : <ChevronRight />}
                                    </button>
                                  </td>
                                </tr>
                                {expandedCategories[category.category] && (
                                  <tr>
                                    <td colSpan="5" className="px-4 py-0">
                                      <div className="bg-gray-50 rounded-lg p-4 my-2">
                                        <h4 className="text-sm font-medium text-gray-700 mb-3">
                                          {category.category} Transactions ({category.transactions.length})
                                        </h4>
                                        <div className="space-y-2 max-h-60 overflow-y-auto">
                                          {category.transactions
                                            .sort((a, b) => b.debitAmount - a.debitAmount)
                                            .map((transaction, txIndex) => (
                                            <div key={txIndex} className="flex items-center justify-between bg-white rounded p-3 text-sm">
                                              <div className="flex-1">
                                                <div className="font-medium text-gray-900">{transaction.date}</div>
                                                <div className="text-gray-600">{transaction.narration}</div>
                                              </div>
                                              <div className="text-right ml-4">
                                                <div className="font-medium text-red-600">
                                                  -{formatCurrency(transaction.debitAmount)}
                                                </div>
                                                <div className="text-xs text-gray-500">
                                                  Balance: {formatCurrency(transaction.closingBalance)}
                                                </div>
                                              </div>
                                            </div>
                                          ))}
                                        </div>
                                      </div>
                                    </td>
                                  </tr>
                                )}
                              </React.Fragment>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    {/* Recent Transactions */}
                    <div className="bg-white rounded-lg shadow-sm p-6">
                      <h3 className="text-lg font-semibold text-gray-900 mb-4">Recent Transactions</h3>
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead>
                            <tr className="border-b border-gray-200">
                              <th className="text-left py-3 px-4 font-semibold text-gray-900">Date</th>
                              <th className="text-left py-3 px-4 font-semibold text-gray-900">Description</th>
                              <th className="text-left py-3 px-4 font-semibold text-gray-900">Category</th>
                              <th className="text-right py-3 px-4 font-semibold text-gray-900">Amount</th>
                            </tr>
                          </thead>
                          <tbody>
                            {filteredTransactions.slice(0, 20).map((transaction, index) => (
                              <tr key={index} className="border-b border-gray-100">
                                <td className="py-3 px-4 text-gray-900">{transaction.date}</td>
                                <td className="py-3 px-4 text-gray-900 max-w-md">
                                  <div className="truncate" title={transaction.narration}>
                                    {transaction.narration.length > 60 ? 
                                      transaction.narration.substring(0, 60) + '...' : 
                                      transaction.narration
                                    }
                                  </div>
                                </td>
                                <td className="py-3 px-4">
                                  <span className="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                    {transaction.category}
                                  </span>
                                </td>
                                <td className={`py-3 px-4 text-right font-medium ${transaction.debitAmount > 0 ? 'text-red-600' : 'text-green-600'}`}>
                                  {transaction.debitAmount > 0 ? '-' : '+'}{formatCurrency(Math.abs(transaction.netAmount))}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </>
                )}
              </div>
            </div>
          );
        };

        // Render the app
        ReactDOM.render(<FinanceAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
